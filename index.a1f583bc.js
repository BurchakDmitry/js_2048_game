const t=new class{constructor(t){this.initialState=t||this.generateNewBoard(),this.board=JSON.parse(JSON.stringify(this.initialState)),this.firstState=JSON.parse(JSON.stringify(this.board)),this.score=0,this.status="idle",this.checkLeft=!0,this.checkRight=!0,this.checkUp=!0,this.checkDown=!0,this.checkStart=!1}getState(){return this.board}getScore(){return this.score}getStatus(){return this.status}moveLeft(){if(this.checkStart){let t=[...this.getState()];this.board=this.board.map(t=>{let e=t.filter(t=>0!==t);for(let t=0;t<e.length;t++)e[t]===e[t+1]&&(e[t]*=2,this.score+=e[t],e[t+1]=0);for(e=e.filter(t=>0!==t);e.length<4;)e.push(0);return e}),this.checkWin()&&(this.status="win"),this.checkLeft=this.differenceArrays(t,this.getState()),this.checkLeft&&this.addRandomTile(this.board),this.checkLose()&&!this.checkWin()&&(this.status="lose")}}moveRight(){if(this.checkStart){let t=[...this.getState()];this.board=this.board.map(t=>{let e=t.filter(t=>0!==t).reverse();for(let t=0;t<e.length;t++)e[t]===e[t+1]&&(e[t]*=2,this.score+=e[t],e[t+1]=0);for(e=e.filter(t=>0!==t);e.length<4;)e.push(0);return e.reverse()}),this.checkWin()&&(this.status="win"),this.checkRight=this.differenceArrays(t,this.getState()),this.checkRight&&this.addRandomTile(this.board),this.checkLose()&&!this.checkWin()&&(this.status="lose")}}moveUp(){if(this.checkStart){let t=[...this.getState()];this.board=this.transpose(this.board),this.moveLeft(),this.board=this.transpose(this.board),this.checkWin()&&(this.status="win"),this.checkUp=this.differenceArrays(t,this.getState()),this.checkLose()&&!this.checkWin()&&(this.status="lose")}}moveDown(){if(this.checkStart){let t=[...this.getState()];this.board=this.transpose(this.board),this.moveRight(),this.board=this.transpose(this.board),this.checkWin()&&(this.status="win"),this.checkDown=this.differenceArrays(t,this.getState()),this.checkLose()&&!this.checkWin()&&(this.status="lose")}}differenceArrays(t,e){return t.flat().join("")!==e.flat().join("")}start(){this.board=this.generateNewBoard(),this.board=JSON.parse(JSON.stringify([...this.firstState])),this.score=0,this.status="win"!==this.getStatus()&&"playing",this.checkStart=!0;for(let t=0;t<2;t++)this.addRandomTile(this.board)}restart(){this.board=JSON.parse(JSON.stringify([...this.firstState])),this.score=0,this.status="idle",this.checkStart=!1}generateNewBoard(){let t=[[],[],[],[]];return t.forEach(t=>{for(let e=0;e<4;e++)t.push(0)}),t}addRandomTile(t){let e=[];for(let s=0;s<t.length;s++)for(let i=0;i<t[s].length;i++)0===t[s][i]&&e.push([s,i]);if(e.length>0){let s=Math.floor(Math.random()*e.length),[i,r]=e[s];t[i][r]=.9>Math.random()?2:4}return t}transpose(t){return t[0].map((e,s)=>t.map(t=>t[s]))}checkWin(){return[...this.board].flat().filter(t=>t>=2048).length>0}checkLose(){for(let t=0;t<4;t++)for(let e=0;e<4;e++)if(0===this.board[t][e])return!1;for(let t=0;t<4;t++)for(let e=0;e<4;e++)if(e<3&&this.board[t][e]===this.board[t][e+1]||t<3&&this.board[t][e]===this.board[t+1][e])return!1;return!0}},e=[...document.querySelector(".game-field").querySelectorAll("td")],s=document.querySelector(".game-score"),i=document.querySelector(".button"),r=document.querySelector(".message-start"),h=document.querySelector(".message-win"),a=document.querySelector(".message-lose");function o(){e.forEach((e,i)=>{let r=t.board.flat(),o=e.textContent;e.classList.remove(`field-cell--${o}`),e.textContent=0!==r[i]?r[i]:"",e.classList.add(`field-cell--${r[i]}`),s.textContent=t.getScore(),"win"===t.getStatus()?h.classList.remove("hidden"):a.classList.toggle("hidden"),"lose"===t.getStatus()?a.classList.remove("hidden"):a.classList.add("hidden")})}i.addEventListener("click",e=>{if("Start"===e.target.textContent){t.start(),e.target.textContent="Restart",e.target.classList.remove("start"),e.target.classList.add("restart"),r.classList.add("hidden"),a.classList.add("hidden"),o(),document.addEventListener("keydown",e=>{switch(e.key){case"ArrowUp":t.moveUp();break;case"ArrowDown":t.moveDown();break;case"ArrowLeft":t.moveLeft();break;case"ArrowRight":t.moveRight()}o()});let s=0,i=0;document.addEventListener("touchstart",function(t){s=t.touches[0].clientX,i=t.touches[0].clientY},!1),document.addEventListener("touchend",e=>{let r=e.changedTouches[0].clientX,h=e.changedTouches[0].clientY,a=r-s,c=h-i;Math.abs(a)>Math.abs(c)?a>100?t.moveRight():a<-100&&t.moveLeft():c>100?t.moveDown():c<-100&&t.moveUp(),o()},!1);return}"Restart"===e.target.textContent&&(t.restart(),e.target.classList.remove("restart"),e.target.classList.add("start"),e.target.textContent="Start",o())});
//# sourceMappingURL=index.a1f583bc.js.map
